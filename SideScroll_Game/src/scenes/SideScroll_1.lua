---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by enki.
--- DateTime: 4/15/24 1:36â€¯AM
---

-- Load GameStates
package.path = package.path .. ";../SideScroll_Game/src/core/?.lua"
local GameStateRegistry = require "GameStates" -- Adjust the path as necessary


-- Add the directory containing the Player.lua module to the Lua package path
-- Path should be relative to the runtime directory of the executable
package.path = package.path .. ";../SideScroll_Game/src/actors/?.lua"

-- Now require the Player module
local player = require("Player")

-- Binding movement functions to key events
registerKeyDownCallback(KeyCode.A, function() player.moveLeft(KeyCode.A) end)
registerKeyUpCallback(KeyCode.A, function() player.stopMoveLeft(KeyCode.A) end)

registerKeyDownCallback(KeyCode.D, function() player.moveRight(KeyCode.D) end)
registerKeyUpCallback(KeyCode.D, function() player.stopMoveRight(KeyCode.D) end)

registerKeyDownCallback(KeyCode.SPACE, function() player.jump(KeyCode.SPACE) end)
registerKeyUpCallback(KeyCode.SPACE, function() player.stopJump(KeyCode.SPACE) end)

function update(deltaTime)
    --logMessage("[INFO] TopDown_Game script called update() with deltaTime: " .. deltaTime);
    player.update(deltaTime);
end

--Function to create backgroundPainting
function createBackgroundPainting()
    -- Create background painting entity
    local backgroundPainting = createEntity()
    logMessage("[INFO] Lua created Entity: " .. backgroundPainting);

    -- Attach components to the entity
    attachComponent(backgroundPainting, ComponentType.Transform)
    attachComponent(backgroundPainting, ComponentType.Renderable)
    attachComponent(backgroundPainting, ComponentType.Sprite)
    attachComponent(backgroundPainting, ComponentType.Texture)

    -- Set sprite, texture, render layer, and initial transform
    setSprite(backgroundPainting, 0, 0, 1280, 720)
    setTexture(backgroundPainting, "../SideScroll_Game/assets/background_enchanted_tech_forest_001.png")
    setRenderLayer(backgroundPainting, RenderLayer.background)
    setTransform(backgroundPainting, 0, 0)
end

function createBoundaryBox(posX, posY, width, height)
    local boundaryBox = createEntity();
    attachComponent(boundaryBox, ComponentType.Transform);
    attachComponent(boundaryBox, ComponentType.Physics);
    attachComponent(boundaryBox, ComponentType.Collider);
    attachComponent(boundaryBox, ComponentType.Sprite);
    setTransform(boundaryBox, posX, posY);
    setBoundaryBox(boundaryBox, posX, -posY, width, height );
    setSprite(boundaryBox, posX, posY, width, height);
    setPhysics(boundaryBox, 0, 0, 0, PhysicsMode.SideScroll, 0, 0);
end

function createPlatform(posX, posY, width, height)
    -- Create background painting entity
    local platform = createEntity()
    logMessage("[INFO] Lua created Entity: " .. platform);

    -- Attach components to the entity
    attachComponent(platform, ComponentType.Transform)
    attachComponent(platform, ComponentType.Renderable)
    attachComponent(platform, ComponentType.Sprite)
    attachComponent(platform, ComponentType.Texture)

    -- Set sprite, texture, render layer, and initial transform
    setSprite(platform, posX, posY, width, height)
    setTexture(platform, "../SideScroll_Game/assets/platform_Basic_001.png")
    setRenderLayer(platform, RenderLayer.foreground)
    setTransform(platform, posX, posY)
end


function constructLevel()
    createBackgroundPainting();
    createBoundaryBox(0, 600, 1280, 5);

    createPlatform(800, 570, 300, 30);
    createBoundaryBox(780, 480, 320, 16);

    createPlatform(340, 440, 300, 30);
    createBoundaryBox(320, 350, 320, 16);

    createPlatform(800, 300, 300, 30);
    createBoundaryBox(780, 210, 320, 16);

    playerUID = player.createPlayerEntity(615, 75, 96, 128);
end

